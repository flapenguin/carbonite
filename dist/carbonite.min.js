!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.carbonite=t():e.carbonite=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,r){"use strict";t.__esModule=!0;var n=navigator.userAgent;t.engine=/WebKit\//.test(n)?"webkit":/Gecko\//.test(n)?"gecko":/Opera\//.test(n)?"presto":/Trident\//.test(n)?"trident":"unknown",t.isChromium=/(Chromium|Chrome|Ya(ndex)?Browser)\//.test(n),t.isSafari=/Safari\//.test(n)&&!t.isChromium,t.isFirefox=/(Firefox|Fennec|Gecko)\//.test(n),t.isIE=/MSIE/.test(n),t.isEdge=/Edge/.test(n),t.isOldOpera=/Opera[\/ ]/.test(n)&&!t.isChromium&&function(e){var t=n.match(e);return t?parseInt(t[1],10):0}(/(?:Version|Opera[\/ ])\/([0-9][0-9\.]*)/)<=12,t.isMobile=/Mobi/.test(n)},function(e,t,r){"use strict";t.__esModule=!0;var n=r(0);t.URL=window.URL||window.webkitURL||window.mozURL||window,t.isSupported=function(e){return!(n.isIE||n.isMobile||n.isFirefox&&e.enabled&&!e.styleNonce||"undefined"==typeof XMLSerializer)},t.isNonSvgSupported=function(e){return t.isSupported(e)&&!n.isSafari&&!n.isOldOpera&&!n.isEdge},t.areBlobsSupported=function(e){return"undefined"!=typeof Blob&&t.URL.createObjectURL&&!n.isSafari}},function(e,t,r){"use strict";function n(e){return"cssFloat"===e?"float":e.replace(/([A-Z])/g,"-$&").replace(/^(webkit|ms|moz)/,"-").toLowerCase()}t.__esModule=!0,t.cssomKeyToCssKey=n},function(e,t,r){"use strict";function n(e){s++,i||(i=document.createElement("div"),i.style.position="absolute",i.style.left="-99999px",i.style.top="-99999px",o().appendChild(i)),i.appendChild(e);var t=i,r=!1;return{dispose:function(){r||(r=!0,t.removeChild(e),0==--s&&(t.parentElement.removeChild(t),i=null))}}}t.__esModule=!0;var o=function(){return document.body},i=null,s=0;t.append=n},function(e,t,r){"use strict";function n(e,t){var r=new Image,n=o.append(r);return new Promise(function(t,n){r.onload=function(){return t()},r.onerror=function(){var t=e.length<=64?e:e.substr(0,61)+"...";n(new Error("carbonite: failed to load image "+t))},r.src=e}).then(function(){return t(r)}).then(function(e){return n.dispose(),e},function(e){return n.dispose(),Promise.reject(e)})}t.__esModule=!0;var o=r(3);t.withLoadedImage=n},function(e,t,r){"use strict";function n(e,t){t=t||{};var r=t.csp||{enabled:!1},n=l.isNonSvgSupported(r),u=t.size||e.getBoundingClientRect(),d=t.type||i.defaultType,f=t.mime||(n?"image/png":"image/svg+xml");if(!l.isSupported(r))return Promise.reject(new Error("carbonite: render is not supported"));if("blob"===d&&!l.areBlobsSupported(r))return Promise.reject(new Error("carbonite: blobs are not supported"));if("image/svg+xml"!==f&&!n)return Promise.reject(new Error("carbonite: only 'image/svg+xml' mime is supported"));if(!u||!u.width||!u.height)return Promise.reject(new Error("carbonite: both width and height must be non-zero"));if(!document.body.contains(e))return Promise.reject(new Error("carbonite: node must be in document"));var m=new a.StyleSheet;return s.inlineStyles(e,m).then(function(e){var t=c.htmlToSvg(e,m,u,r);return"image/svg+xml"===f?i.fromString(t,f,d):o(t,{mime:f,type:d,size:u,csp:r})})}function o(e,t){var r=i.fromString(e,"image/svg+xml",i.getResourceTypeForForeignObjectSvg(t.csp)),n=document.createElement("canvas"),o=n.getContext("2d");return n.width=t.size.width,n.height=t.size.height,u.withLoadedImage(r.url,function(e){return o.drawImage(e,0,0)}).then(function(){return r.destroy(),i.fromCanvas(n,t.mime,t.type)})}t.__esModule=!0;var i=r(6),s=r(8),u=r(4),a=r(9),c=r(10),l=r(1);t.render=n},function(e,t,r){"use strict";function n(e){return{type:"data-url",mime:(e.match(/^data:(.*?);/)||["",""])[1],url:e,destroy:function(){}}}function o(e){var t=a.URL.createObjectURL(e);return{type:"blob",mime:(e.type.match(/^([^\/]*\/[^;]*)/)||["",""])[1],url:t,destroy:function(){a.URL.revokeObjectURL(t)}}}function i(e,r,i){if("blob"===(i=i||t.defaultType))return o(new Blob([e],{type:r+";charset=utf-8"}));if("data-url"===i){return n("data:"+r+";base64,"+c.encode(e))}throw new Error("carbonite: bad resource type, expected 'blob' or 'data-uri', got "+i)}function s(e,r,i){i=i||t.defaultType;try{if("data-url"===i)return Promise.resolve(n(e.toDataURL(r)));if("blob"===i)return new Promise(function(t,n){e.toBlob(function(e){e?t(o(e)):n(new Error("carbonite: cannot render canvas"))},r)})}catch(e){return Promise.reject(e)}return Promise.reject(null)}function u(e){return e.enabled&&!e.imageBlob?"data-url":l.isChromium?"data-url":a.areBlobsSupported(e)?"blob":"data-url"}t.__esModule=!0;var a=r(1),c=r(7),l=r(0);t.defaultType="blob",t.fromDataUrl=n,t.fromBlob=o,t.fromString=i,t.fromCanvas=s,t.getResourceTypeForForeignObjectSvg=u},function(e,t,r){"use strict";function n(e){return e=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}),btoa(e)}t.__esModule=!0,t.encode=n},function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error("inlineStyles: node must be not null");return e.nodeType===Node.TEXT_NODE?Promise.resolve(document.createTextNode(e.textContent||"")):e.nodeType!==Node.ELEMENT_NODE?Promise.resolve(null):o(e,t)}function o(e,t){if("none"===e.style.display)return Promise.resolve(document.createComment("<"+e.tagName+"> with display: none"));var r=e.tagName.toLowerCase(),o=/^(canvas|img)$/.test(r)?"div":r,c=document.createElement(o),d=s(e),h=l.append(c),g=i(s(c));h.dispose();var b=[];for(var v in d)if(!/^(\d+|length|cssText)$|-/.test(v)&&!m.test(v)&&!p.test(v)){var y=d[v],w=typeof y;if("function"!==w&&"undefined"!==w&&null!=y){var S=f.test(v);(g[v]!==d[v]||S)&&(""!==(y=String(y))||S)&&b.push(a.cssomKeyToCssKey(v)+":"+y+";")}}if("canvas"===r)try{var x=e.toDataURL();b.push('background-image: url("'+x+'");')}catch(e){}var C=Promise.resolve();return"img"===r&&(b.push("display: block;"),C=u(e).then(function(e){e&&b.push('background-image: url("'+e+'");')}).catch(function(e){})),C.then(function(){var r=e.getAttribute("class")||"";r&&c.setAttribute("data-carbonite-class",r),c.className=t.createClass(b.join(""));for(var o=[],i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];o.push(n(s,t))}return Promise.all(o).then(function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];n&&c.appendChild(n)}return c})})}function i(e){var t={};for(var r in e)h.call(e,r)&&(t[r]=e[r]);return t}function s(e){return e.ownerDocument.defaultView.getComputedStyle(e)}function u(e){var t=e.width,r=e.height,n=e.src;return t&&r&&n?d.withLoadedImage(n,function(e){var n=document.createElement("canvas");return n.width=t,n.height=r,n.getContext("2d").drawImage(e,0,0),n.toDataURL()}):Promise.resolve(null)}t.__esModule=!0;var a=r(2),c=r(0),l=r(3),d=r(4),f=/^transform-origin^/,m=/^(transition|cursor|animation|userSelect)/,p="webkit"!==c.engine?/^(?=a)b/:/^(background|outline|border|webkitBorder(Before|After|End|Start))[A-Z]/;t.inlineStyles=n;var h={}.hasOwnProperty},function(e,t,r){"use strict";function n(e){var t=[];for(var r in e)t.push(o.cssomKeyToCssKey(r)+": "+e[r]+";");return t.join("")}t.__esModule=!0;var o=r(2),i=function(){function e(){this.styles=[],this.counter=0}return e.prototype.createClass=function(e){var t="x"+this.counter++,r="string"==typeof e?e:n(e);return this.styles.push("."+t+" { "+r+" }"),t},e.prototype.combine=function(){return this.styles.join("")},e}();t.StyleSheet=i},function(e,t,r){"use strict";function n(e,t,r,n){var o=(new XMLSerializer).serializeToString(e),i=t.createClass({position:"relative",width:"100%",height:"100%",margin:"0",padding:"0",overflow:"hidden"});return'\n        <svg xmlns="http://www.w3.org/2000/svg" width="'+r.width+'" height="'+r.height+'">\n            <style '+(n.enabled?'nonce="'+n.styleNonce+'"':"")+">\n                "+t.combine()+'\n            </style>\n            <foreignObject width="100%" height="100%">\n                <body xmlns="http://www.w3.org/1999/xhtml" class="'+i+'">\n                    '+o+"\n                </body>\n            </foreignObject>\n        </svg>\n    "}t.__esModule=!0,t.htmlToSvg=n}])});